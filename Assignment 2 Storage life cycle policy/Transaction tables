
-- Transaction Schema and Tables
USE DATABASE CUSTOMER_TRANSACTIONS_PROD_DB;
CREATE OR REPLACE SCHEMA AMAZON;
CREATE OR REPLACE SCHEMA FLIPKART;
CREATE OR REPLACE SCHEMA GOOGLE;

-- Template table structure, including the crucial CREATED_AT column
CREATE OR REPLACE TABLE PUBLIC.TRANSACTION_TEMPLATE (
    TRANSACTION_ID INT,
    CREATED_AT TIMESTAMP_NTZ DEFAULT CURRENT_TIMESTAMP(),
    TRANSACTION_DETAILS VARCHAR(100)
);

-- Main Transaction tables in the respective schemas
CREATE OR REPLACE TABLE AMAZON.TRANSACTIONS LIKE PUBLIC.TRANSACTION_TEMPLATE;
CREATE OR REPLACE TABLE FLIPKART.TRANSACTIONS LIKE PUBLIC.TRANSACTION_TEMPLATE;
CREATE OR REPLACE TABLE GOOGLE.TRANSACTIONS LIKE PUBLIC.TRANSACTION_TEMPLATE;



USE DATABASE CUSTOMER_TRANSACTIONS_PROD_DB;

--- *** DATA INSERTION STATEMENTS *** ---

INSERT INTO AMAZON.TRANSACTIONS (TRANSACTION_ID, CREATED_AT, TRANSACTION_DETAILS) 
VALUES (101, DATEADD(DAY, -4, CURRENT_TIMESTAMP()), 'Archived everywhere');
INSERT INTO FLIPKART.TRANSACTIONS (TRANSACTION_ID, CREATED_AT, TRANSACTION_DETAILS) 
VALUES (201, DATEADD(DAY, -4, CURRENT_TIMESTAMP()), 'Archived everywhere');
INSERT INTO GOOGLE.TRANSACTIONS (TRANSACTION_ID, CREATED_AT, TRANSACTION_DETAILS) 
VALUES (301, DATEADD(DAY, -4, CURRENT_TIMESTAMP()), 'Archived everywhere');

INSERT INTO AMAZON.TRANSACTIONS (TRANSACTION_ID, CREATED_AT, TRANSACTION_DETAILS) 
VALUES (102, DATEADD(DAY, -2, CURRENT_TIMESTAMP()), 'Amazon archived, others keep');
INSERT INTO FLIPKART.TRANSACTIONS (TRANSACTION_ID, CREATED_AT, TRANSACTION_DETAILS) 
VALUES (202, DATEADD(DAY, -2, CURRENT_TIMESTAMP()), 'Amazon archived, others keep');
INSERT INTO GOOGLE.TRANSACTIONS (TRANSACTION_ID, CREATED_AT, TRANSACTION_DETAILS) 
VALUES (302, DATEADD(DAY, -2, CURRENT_TIMESTAMP()), 'Amazon archived, others keep');

INSERT INTO AMAZON.TRANSACTIONS (TRANSACTION_ID, CREATED_AT, TRANSACTION_DETAILS) 
VALUES (103, CURRENT_TIMESTAMP(), 'Kept everywhere');
INSERT INTO FLIPKART.TRANSACTIONS (TRANSACTION_ID, CREATED_AT, TRANSACTION_DETAILS) 
VALUES (203, CURRENT_TIMESTAMP(), 'Kept everywhere');
INSERT INTO GOOGLE.TRANSACTIONS (TRANSACTION_ID, CREATED_AT, TRANSACTION_DETAILS) 
VALUES (303, CURRENT_TIMESTAMP(), 'Kept everywhere');

-- Quick check on initial counts (Should be 3 rows in each table)
SELECT COUNT(*) FROM AMAZON.TRANSACTIONS; 
SELECT COUNT(*) FROM FLIPKART.TRANSACTIONS;
SELECT COUNT(*) FROM GOOGLE.TRANSACTIONS;

