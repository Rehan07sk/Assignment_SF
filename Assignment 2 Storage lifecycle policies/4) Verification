-- Verification query
SELECT 
    m.CUSTOMER_NAME,
    m.RETENTION_DAYS AS EXPECTED_RETENTION_DAYS,
    t.TABLE_SCHEMA,
    t.TABLE_NAME,
    t.RETENTION_TIME AS ACTUAL_RETENTION_DAYS,
    CASE 
        WHEN m.RETENTION_DAYS = t.RETENTION_TIME THEN 'MATCHED'
        ELSE 'NOT MATCHED'
    END AS POLICY_STATUS
FROM METADATA_DB.METADATA_SCHEMA.CUSTOMER_RETENTION_METADATA m
LEFT JOIN CUSTOMER_TRANSACTIONS_DB.INFORMATION_SCHEMA.TABLES t
    ON t.TABLE_SCHEMA = UPPER(m.CUSTOMER_NAME || '_SCHEMA')
    AND t.TABLE_NAME = 'TRANSACTION'
ORDER BY m.CUSTOMER_NAME;
